var Parent = React.createClass({

  getInitialState: function() {
    return {
      rank: "alltime"
    };
  },

  monthPoints: function() {
    this.setState({
      rank: "recent"
    });
  },

  allTimePoints: function() {
    this.setState({
      rank: "alltime"
    });
  },

  render: function() {
    return (

      <table className="striped">
  <thead>
    <tr>
      <th data-field="rank">#</th>
      <th data-field="name">Name</th>
      <MonthPoints onClick={this.monthPoints} />
      <AllPoints onClick={this.allTimePoints} />
    </tr>
  </thead>

  <DisplayChart rank={this.state.rank} />
</table>

    );
  }
});

function MonthPoints(props) {
  return <th onClick={props.onClick} data-field="recent" className="button">Points in Last 30 Days</th>;
}

function AllPoints(props) {
  return <th onClick={props.onClick} data-field="alltime" className="button">All Time Points</th>;
}

var DisplayChart = React.createClass({

  getInitialState: function() {
    return {
      data: {
        __html: "Loading....."
      }
    };
  },

  getData: function(url) {
    var tableString = "";
    $.getJSON(url, function(data) {
      for (var i = 0; i < 100; i++) {
        var t = i + 1;
        tableString = tableString.concat("<tr><td>" + t + "</td><td>" + data[i].username + "</td><td>" + data[i].recent + "</td><td>" + data[i].alltime + "</td></tr>");
      }
      tableString = {__html: tableString};
      this.setState({
        data: tableString
      });
    }.bind(this));
  },
  
  componentWillMount: function() {
    var url = "https://fcctop100.herokuapp.com/api/fccusers/top/alltime";
    this.getData(url);
  },

  componentWillReceiveProps: function (nextProps) {
    var url = nextProps.rank == "alltime" ? "https://fcctop100.herokuapp.com/api/fccusers/top/alltime" : "https://fcctop100.herokuapp.com/api/fccusers/top/recent";
    this.getData(url);
  },
  
  
  render: function() {
    return <tbody dangerouslySetInnerHTML={this.state.data}></tbody>;
  }

});

ReactDOM.render(<Parent />, document.getElementById('app'));